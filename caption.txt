def get_caption_value(worker_idx=None):
    """
    Tráº£ vá» 1 caption theo lá»±a chá»n:
    - default:  1 cÃ¢u máº·c Ä‘á»‹nh ngáº¯n gá»n
    - random:   bá»‘c ngáº«u nhiÃªn tá»« danh sÃ¡ch Ã´ Text
    - byline:   láº¥y láº§n lÆ°á»£t tá»«ng dÃ²ng (nhiá»u thiáº¿t bá»‹/láº§n post sáº½ vÃ²ng trÃ²n)
    """
    mode = caption_mode_var.get()
    lines = _read_caption_lines()
    if mode == "random" and lines:
        import random
        return random.choice(lines)
    if mode == "byline" and lines:
        global _caption_line_pos
        if worker_idx is not None:
            return lines[worker_idx % len(lines)]
        value = lines[_caption_line_pos % len(lines)]
        _caption_line_pos += 1
        return value
    return "Hello Instagram! #firstpost"

# ======= Táº¡o 100 caption ngáº¯n =======
def generate_captions_to_text(n=100):
    """Sinh n caption ngáº¯n & ghi vÃ o caption_text_widget (má»—i dÃ²ng má»™t caption)."""
    if caption_text_widget is None:
        return
    starts = [
        "NgÃ y má»›i","Má»™t chÃºt","Chill nháº¹","HÃ´m nay","Cuá»‘i tuáº§n","Vibes","Tá»›i cÃ´ng chuyá»‡n",
        "Äi thÃ´i","ÄÆ¡n giáº£n","Nhá» thÃ´i","Tá»± thÆ°á»Ÿng","Thá»© hai","Thá»© sÃ¡u","Buá»•i sÃ¡ng",
        "Buá»•i tá»‘i","Láº·ng láº½","XÃ­u xiu","NÄƒng lÆ°á»£ng","Tháº£nh thÆ¡i","GÃ³c nhá»"
    ]
    verbs = [
        "báº¯t Ä‘áº§u","thÆ° giÃ£n","lÃªn Ä‘Æ°á»ng","táº­n hÆ°á»Ÿng","cá»‘ gáº¯ng","cÆ°á»i lÃªn","nghá»‰ ngÆ¡i",
        "chÃ¡y háº¿t mÃ¬nh","giá»¯ nhá»‹p","cháº­m láº¡i","táº­p trung","lan toáº£","sáº¡c pin","quay láº¡i",
        "khai má»Ÿ","refresh","check-in","Ä‘á»•i giÃ³","tÄ©nh tÃ¢m","giá»¯ lá»­a"
    ]
    endings = [
        "thÃ´i nÃ o","xÃ­u nhÃ©","nháº¹ nhÃ ng","cho vui","Ä‘á»§ rá»“i","váº­y thÃ´i","mÃ£i Ä‘á»‰nh",
        "vÃ¬ mÃ¬nh xá»©ng Ä‘Ã¡ng","má»™t mÃ¬nh cÅ©ng vui","tháº¿ lÃ  Ä‘á»§","háº¿t sáº£y","Ä‘Ãºng bÃ i",
        "Ä‘áº¹p quÃ¡","á»•n Ã¡p","okela","lÃªn luÃ´n","Ä‘Æ°á»£c pháº¿t","Ä‘i thÃ´i","khá»e re","chill pháº¿t"
    ]
    emojis = ["âœ¨","ğŸŒ¤ï¸","ğŸŒ¿","ğŸŒŠ","â˜•","ğŸ’«","ğŸ“¸","ğŸ§‹","ğŸ€","ğŸ§˜","ğŸŒ™","ğŸ”¥","ğŸŒˆ","ğŸ§","ğŸŒ»","ğŸª´","ğŸ¥¤","ğŸ“–","ğŸ’­","ğŸ˜Œ"]
    hash1  = ["#vibes","#chill","#today","#goodday","#simple","#instagood","#mood","#daily","#minimal","#happy"]
    hash2  = ["#selfcare","#lifestyle","#photo","#moment","#relax","#energy","#focus","#reset","#motivation","#dayone"]

    seen, caps, tries = set(), [], 0
    while len(caps) < n and tries < n*10:
        tries += 1
        s, v, e = random.choice(starts), random.choice(verbs), random.choice(endings)
        em1 = random.choice(emojis) if random.random() < 0.8 else ""
        em2 = random.choice(emojis) if random.random() < 0.4 else ""
        hs = ""
        if random.random() < 0.6:
            hs_list = [random.choice(hash1)]
            if random.random() < 0.5:
                hs_list.append(random.choice(hash2))
            hs = " " + " ".join(hs_list)
        cap = " ".join(x for x in [em1, s, v, e + ".", em2] if x).strip()
        cap = (cap + " " + hs).strip()
        if cap not in seen:
            seen.add(cap); caps.append(cap)
    caption_text_widget.delete("1.0", "end")
    caption_text_widget.insert("1.0", "\n".join(caps))

# ===== Caption UI =====
cap_frame = ttk.LabelFrame(phone_settings, text="Caption Options")
cap_frame.pack(fill="x", padx=PHONE_PADX, pady=(2, PHONE_PADY))

ttk.Radiobutton(cap_frame, text="Caption máº·c Ä‘á»‹nh",
                variable=caption_mode_var, value="default").grid(row=0, column=0, sticky="w", padx=10, pady=2)
ttk.Radiobutton(cap_frame, text="Ngáº«u nhiÃªn",
                variable=caption_mode_var, value="random").grid(row=1, column=0, sticky="w", padx=10, pady=2)
ttk.Radiobutton(cap_frame, text="Tá»«ng dÃ²ng",
                variable=caption_mode_var, value="byline").grid(row=2, column=0, sticky="w", padx=10, pady=2)

caption_text_widget = tk.Text(cap_frame, width=34, height=8, wrap="word")
caption_text_widget.grid(row=3, column=0, columnspan=2, sticky="nsew", padx=10, pady=(6,6))
caption_text_widget.insert("1.0", "Hello IG! ğŸ‘‹\nNew day, new vibe ğŸŒ¤ï¸\nLife is good.\n#firstpost #instagood")

# NÃºt táº¡o 100 caption
ttk.Button(cap_frame, text="Táº¡o caption ngáº¯n",
           command=lambda: generate_captions_to_text(200))\
    .grid(row=4, column=0, sticky="w", padx=10, pady=(0,6))

cap_frame.columnconfigure(0, weight=1)